<!doctype html><html lang=es-es><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary"><meta name=twitter:title content="Buscador en PHP"><meta name=twitter:description content><meta name=twitter:site content="@obokaman"><meta property="og:title" content="Buscador en PHP &#183; Albert García Gibert"><meta property="og:site_name" content="Albert García Gibert"><meta property="og:url" content="https://albert.garcia.gibert.es/buscador-en-php-433/"><meta property="og:image" content="https://albert.garcia.gibert.es/images/background-202006041954.jpg"><meta property="og:description" content><meta property="og:type" content="article"><meta property="article:published_time" content="2004-12-10T00:18:37Z"><meta property="article:tag" content="buscadores"><meta property="article:tag" content="desarrollo web"><meta property="article:tag" content="php"><title>Buscador en PHP &#183; Albert García Gibert</title><meta name=description content="Bueeeno, aquesta nit toca post t&amp;egrave;cnic, que ja he aconseguit _quasi_ acabar una de les parts que trobo m&amp;eacute;s interessant del blog: el cercador. Amb e"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://albert.garcia.gibert.es/images/favicon.ico><link rel=apple-touch-icon href=https://albert.garcia.gibert.es/images/apple-touch-icon.png><link rel=stylesheet type=text/css href=https://albert.garcia.gibert.es/css/screen.css?v2><link rel=stylesheet type=text/css href=https://albert.garcia.gibert.es/css/nav.css?v2><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link href=https://albert.garcia.gibert.es/index.xml rel=alternate type=application/rss+xml title="Albert García Gibert"><meta name=generator content="Hugo 0.72.0"><link rel=canonical href=https://albert.garcia.gibert.es/buscador-en-php-433/><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","publisher":{"@type":"Organization","name":null,"logo":"https://albert.garcia.gibert.es/favicon.ico"},"author":{"@type":"Person","name":null,"image":{"@type":"ImageObject","url":"https://albert.garcia.gibert.es/favicon.ico","width":250,"height":250},"url":"https://albert.garcia.gibert.es","sameAs":[],"description":"Cofounder and former CTO of @Uvinum, founder of @Obolog. Father of @soclajulia \u0026 @soclabril . I'd like to travel more and improve my guitar skills."},"headline":"Buscador en PHP","name":"Buscador en PHP","wordCount":952,"timeRequired":"PT5M","inLanguage":{"@type":"Language","alternateName":"en"},"url":"https://albert.garcia.gibert.es/buscador-en-php-433/","datePublished":"2004-12-10T00:18Z","dateModified":"2004-12-10T00:18Z","keywords":"buscadores, desarrollo web, php","description":"","mainEntityOfPage":{"@type":"WebPage","@id":"https://albert.garcia.gibert.es/buscador-en-php-433/"}}</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-97247-14','auto');ga('send','pageview');</script><link rel=preload href=https://albert.garcia.gibert.es/fonts/Open_Sans/OpenSans-Regular.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Open_Sans/OpenSans-Bold.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-Light.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-LightItalic.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-Bold.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-BoldItalic.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Inconsolata/Inconsolata-Regular.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Genericons/Genericons.woff as=font type=font/woff crossorigin></head><body class=nav-closed><div class=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Cerrar</span></a><ul></ul><a class="subscribe-button icon-feed" href=https://albert.garcia.gibert.es/index.xml>Suscríbete</a></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head no-cover"><nav class="main-nav clearfix"><a class=blog-logo href=https://albert.garcia.gibert.es/><img src=https://albert.garcia.gibert.es/favicon.ico alt=Home></a>
<a class="menu-button icon-feed" href=https://albert.garcia.gibert.es/index.xml>&nbsp;&nbsp;Suscríbete</a></nav></header><main class=content role=main><article class="post post-template post"><header class=post-header><h1 class=post-title>Buscador en PHP</h1><small></small><section class=post-meta><time class=post-date datetime=2004-12-10T00:18:37Z>10 diciembre 2004</time>
<span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/buscadores/>#buscadores</a></span><span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/desarrollo-web/>#desarrollo web</a></span><span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/php/>#php</a></span></section></header><section class=post-content><p>Bueeeno, aquesta nit toca post t&#232;cnic, que ja he aconseguit _quasi_ acabar una de les parts que trobo m&#233;s interessant del blog: el <a href=https://albert.garcia.gibert.es/buscar.php>cercador</a>. Amb el pas del temps la quantitat d'informaci&#243; enregistrada a la web ha augmentat considerablement, i sense una bona categoritzaci&#243; i organitzaci&#243; dels continguts, certs missatges corren el perill de caure en l'oblit. En aquest sentit, tenir un arxiu de missatges agrupats per categories o data pot ser molt &#250;til, per&#242; perd efectivitat quan parlem de categor&#237;es amb m&#233;s de 100 missatges. Trobar un post concret es pot convertir en tota una aventura. &#201;s aqui on es posa a prova la utilitat d'un cercador eficient.</p><p>La majoria de cercadors que he pogut veure a altres llocs web es limiten a fer cerques per paraules a la base de dades, permetent fer la cerca al t&#237;tol, al contingut de la web, a paraules clau, etc... i utilitzant operadors del tipus "LIKE" per trobar coincid&#232;ncies amb els termes de recerca. Aquest sistema presenta for&#231;a limitacions, com haver de repetir la cerca per separat per cada paraula, especificar per separat tots els camps de la base de dades on s'ha de mirar, impossibilitat de donar m&#233;s import&#224;ncia a unes paraules que d'altres, filtrar paraules de poca rellev&#224;ncia... &#201;s aqui on vaig descobrir la utilitat d'un tipus d'index que utilitza <a href=http://www.mysql.com/ target=_blank>MySQL</a>, anomenat "<a href=http://dev.mysql.com/doc/mysql/en/Fulltext_Search.html target=_blank>FULL TEXT</a>". La troballa de l'any, certament. El "FULL TEXT" ens permet agrupar diversos camps en un sol &#237;ndex, per poder realitzar-hi cerques conjuntes mitjan&#231;ant una sola cadena de car&#224;cters (una paraula o frase), i afegir-hi modificadors a l'estil <a href=http://www.google.es target=_blank>Google</a>. &#201;s a dir, podem utilitzar modificadors com les cometes, per agrupar paraules, els simbols &lt; i > per especificar una major o menos rellev&#224;ncia de certa paraula, els simbols - o + per mostrar nom&#233;s resultats que contingin o no una paraula determinada... I tot aix&#242; de manera autom&#224;tica, amb una consulta senzilla.</p><p>Un exemple ens ho far&#224; m&#233;s f&#224;cil d'entendre: Imagineu que vull buscar un manual de photoshop a la web. La consulta que realitzaria a la base de dades, on pr&#232;viament he creat un &#237;ndex FULL TEXT per a certs camps que m'interessen seria</p><div class=codigo>SELECT * FROM posts WHERE MATCH(titulo,descripcion,contenido,contenido_ext,tipo) AGAINST ('manual de photoshop')</div><p>Llestos, aix&#237; de senzill. Les cerques de FULL TEXT ens permeten, a m&#233;s, con&#232;ixer la rellev&#224;ncia (el camp score) de les coincid&#232;ncies per a cada registre trobat. Aix&#237; podem tamb&#232; ordenar els resultats segons s'acostin m&#233;s o menys al que busc&#224;vem. Aix&#242; ho fariem de la seg&uuml;ent manera.</p><div class=codigo>SELECT *,MATCH(titulo,descripcion,contenido,contenido_ext,tipo) AGAINST ('manual de photoshop') as score FROM posts WHERE MATCH(titulo,descripcion,contenido,contenido_ext,tipo) AGAINST ('manual de photoshop') ORDER BY score desc;</div><p>Nom&#233;s amb aix&#242; ja disposariem d'una eina for&#231;a potent per trobar informaci&#243; a una base de dades (els &#237;ndex FULL TEXT permeten cerques molt m&#233;s complexes que aquestes, aix&#242; us ho deixo investigar a <a href=http://dev.mysql.com/doc/mysql/en/Fulltext_Search.html target=_blank>les pr&#242;pies especificacions de la p&#225;gina de MySQL</a>). Ens trobem, per&#242;, que tan sols un llistat amb el t&#237;tol dels missatges en qu&#232; hem trobat continguts interessants pot no ser &#250;til, si la cerca no &#233;s suficientment acurada, i tots sabem per experi&#232;ncia que afinar amb les paraules correctes no &#233;s tasca senzilla. &#201;s aqui on em vaig plantejar de implantar un sistema d'extracci&#243; de texte rellevant per la p&#224;gina de resultats del cercador. De nou el sistema de <a href=http://www.google.es target=_blank>Google</a> que ens mostra la part de la p&#224;gina on apareixen les paraules que estem buscant, em va semblar la millor opci&#243;. D'un sol cop d'ull pots veure si aquell missatge on apareixen els termes que busques parla realment del que vol&#237;es, ja que no necess&#224;riament ha de ser sempre aix&#237;.</p><p>El que faig es separar cada una de les paraules, eliminar les paraules massa curtes, i veure a quina posici&#243; dins del contingut del missatge es troben la resta. Despr&#233;s ordeno aquestes posicions i busco aquella part del texte on aquest termes es troben m&#233;s aprop entre ells, per mostrar-la a mode d'extracte. Aquest seria l'exemple en PHP, que &#233;s el llenguatge en qu&#232; s'ha programat obokaman.com</p><div class=codigo>$busca_ace = array ("&#225;","&#233;","&#237;","&#243;","&#250;","&#193;","&#201;","&#205;","&#211;","&#218;","&#224;","&#232;","&#236;","&#242;","&#249;","&#192;","&#200;","&#204;","&#210;","&#217;","+","&lt;",">");<br>$reemplaza_ace = array ("a","e","i","o","u","A","E","I","O","U","a","e","i","o","u","A","E","I","O","U"," "," "," ");<br><br>$buscar=trim(strtolower($texto));<br>$buscar=str_replace($busca_ace, $reemplaza_ace, $buscar);<br><br>$texto_tmp=explode(" ",$buscar);<br>foreach ($texto_tmp as $valor) {<br><br>if (strlen($valor)>3) {<br>$texto_tmp2[]=$valor;<br>}else{<br>$texto_tmp3[]=$valor;<br>}<br><br>}<br>if (is_array($texto_tmp2)) {<br>$texto_incluido=implode(",",$texto_tmp2);<br>}<br>if (is_array($texto_tmp3)) {<br>$texto_omitido=implode(",",$texto_tmp3);<br>}</div><p>Ara tenim les paraules que ens interessen (les m&#233;s llargues de 3 car&#224;cters) a un array anomenat $texto_tmp2. Nom&#233;s caldr&#224; rec&#242;rrer aquest array a cada missatge per cercar les coincid&#232;ncies, mirar la seva posici&#243;, i destacar cada paraula al texte resultant.</p><div class=codigo>$text1=html_entity_decode($mensaje);<br>$text1=str_replace($busca_ace, $reemplaza_ace, $text1);<br>$text1=preg_replace('/[\n\r\t]/',' ',$text1);<br>if (is_array($texto_tmp2)) {//4<br>$posiciones= array();<br>foreach ($texto_tmp2 as $valor) {<br>$string=strtolower($text1);<br>$searched=strtolower($valor);<br>$offsets= array();<br>$next=0;<br><br>while(1){<br>$entry = strpos(<br>$string,<br>$searched,<br>$next+$offsets[sizeof($offsets)-1] /*juggling*/<br>);<br>if(gettype($entry)==boolean){break;};<br>$next=strlen($searched);<br>$offsets[]=$entry;<br>}<br><br>$posiciones=array_merge($posiciones,$offsets);<br>}<br>sort($posiciones);<br>for ($i=0;$i<sizeof><br>$n=1;<br>while ($posiciones[($i+$n)]&&($posiciones[($i+$n)]-$posiciones[$i])&lt;500) {<br>if ($n>$max) {<br>$max=$n;<br>$posicion_def=$posiciones[$i];<br>}<br>$n++;<br>}<br>}<br>if ($posicion_def) {<br>$posicion1=$posicion_def;<br>}else{<br>$posicion1=$posiciones[0];<br>}<br>if ($posicion1>60) {<br>$posicion1=$posicion1-60;<br>}else{<br>$posicion1=0;<br>}<br>unset($posicion_def);<br>unset($posiciones);<br>unset($offsets);<br>unset($max);<br>}<br>$text1 = substr(trim($text1),$posicion1,500);<br>if ($text1!="") {<br>$text1 = '[...]'.$text1.'[...]';<br>}<br>foreach ($texto_tmp2 as $valor) {<br>$text1 = eregi_replace("($valor)","\\1",$text1);<br>}</sizeof></div><p>$mensaje &#233;s la variable que cont&#233; tot el text de cada post. Primer busquem les posicions de les coincid&#232;ncies. Despr&#233;s busquem la posici&#243; m&#233;s alta en qu&#232; les paraules es trobin m&#233;s properes entre elles (al menys de 500 car&#224;cters entre cadascuna), i finalment, utilitzem aquesta posici&#243; per fer un extracte de 500 car&#224;cters d'aquesta porci&#243; del text, destacant cada paraula amb un . Aix&#242;, a mode d'esbo&#231;, &#233;s el que fa el cercador d'obokaman per cercar i mostrar els resultats. &#201;s el millor de fer les coses a m&#224;: que fan exactament el qu&#232; tu vols. Estar&#233; encantat de sentir les teves sugger&#232;ncies, cr&#237;tiques, consells per millorar aquest sistema. <a href=https://albert.garcia.gibert.es/buscar.php>Encara no l'has provat?</a></p></section><footer class=post-footer><figure class=author-image><a class=img href=https://albert.garcia.gibert.es/ style=background-image:url(/images/avatar.jpg)><span class=hidden>Foto de Albert García Gibert</span></a></figure><section class=author><h4><a href=https://albert.garcia.gibert.es/>Albert García Gibert</a></h4><p>Cofounder and former CTO of @Uvinum, founder of @Obolog. Father of @soclajulia & @soclabril . I'd like to travel more and improve my guitar skills.</p><div class=author-meta><span class="author-location icon-location">El Prat de Llobregat, Barcelona</span>
<span class="author-link icon-link"><a href=https://albert.garcia.gibert.es>https://albert.garcia.gibert.es</a></span></div></section><section class=share><h4>Compartir post</h4><a class=icon-twitter style=font-size:1.4em href="https://twitter.com/share?text=Buscador%20en%20PHP&nbsp;-&nbsp;Albert%20Garc%c3%ada%20Gibert&url=https%3a%2f%2falbert.garcia.gibert.es%2fbuscador-en-php-433%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><span class=hidden>Twitter</span></a>
<a class=icon-facebook style=font-size:1.4em href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2falbert.garcia.gibert.es%2fbuscador-en-php-433%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><span class=hidden>Facebook</span></a>
<a class=icon-pinterest style=font-size:1.4em href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2falbert.garcia.gibert.es%2fbuscador-en-php-433%2f&description=Buscador%20en%20PHP" onclick="window.open(this.href,'pinterest-share','width=580,height=296');return false;"><span class=hidden>Pinterest</span></a></section><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https:\/\/albert.garcia.gibert.es\/buscador-en-php-433\/";this.page.identifier="https:\/\/albert.garcia.gibert.es\/buscador-en-php-433\/";};(function(){var d=document,s=d.createElement('script');s.src='https://albert-garcia-gibert.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></footer></article></main><aside class=read-next><a class=read-next-story style=no-cover href=https://albert.garcia.gibert.es/rellotge-futur-434/><section class=post><h2>El rellotge del futur</h2></section></a><a class="read-next-story prev" style=no-cover href=https://albert.garcia.gibert.es/inauguracio-feedness-431/><section class=post><h2>Inauguració de Feedness</h2></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href>Albert García Gibert</a></section><section class=poweredby>Generado con <a class=icon-hugo href=http://gohugo.io>HUGO</a>, con el tema <a class=icon-theme href=https://github.com/vjeantet/hugo-theme-casper>Casper</a></section></footer></div><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script type=text/javascript src=https://albert.garcia.gibert.es/js/jquery.fitvids.js></script><script type=text/javascript src=https://albert.garcia.gibert.es/js/index.js></script></body></html>