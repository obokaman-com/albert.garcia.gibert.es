<!doctype html><html lang=es-es><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary"><meta name=twitter:title content="Upload de archivos y progressbar con PHP,Perl y AJAX"><meta name=twitter:description content><meta name=twitter:site content="@obokaman"><meta property="og:title" content="Upload de archivos y progressbar con PHP,Perl y AJAX &#183; Albert García Gibert"><meta property="og:site_name" content="Albert García Gibert"><meta property="og:url" content="https://albert.garcia.gibert.es/upload-archivos-progressbar-phpperl-ajax-1511/"><meta property="og:image" content="https://albert.garcia.gibert.es/images/background-202006041954.jpg"><meta property="og:description" content><meta property="og:type" content="article"><meta property="article:published_time" content="2006-03-15T21:41:06Z"><meta property="article:tag" content="ajax"><meta property="article:tag" content="desarrollo web"><meta property="article:tag" content="javascript"><meta property="article:tag" content="web 2.0"><title>Upload de archivos y progressbar con PHP,Perl y AJAX &#183; Albert García Gibert</title><meta name=description content="A&amp;uacute;n cuando no he conseguido desentramar el misterio de la antena reaparecida, otra misteriosa casualidad ha roto mi paz interior, esta vez relacionada co"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://albert.garcia.gibert.es/images/favicon.ico><link rel=apple-touch-icon href=https://albert.garcia.gibert.es/images/apple-touch-icon.png><link rel=stylesheet type=text/css href=https://albert.garcia.gibert.es/css/screen.css?v2><link rel=stylesheet type=text/css href=https://albert.garcia.gibert.es/css/nav.css?v2><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link href=https://albert.garcia.gibert.es/index.xml rel=alternate type=application/rss+xml title="Albert García Gibert"><meta name=generator content="Hugo 0.72.0"><link rel=canonical href=https://albert.garcia.gibert.es/upload-archivos-progressbar-phpperl-ajax-1511/><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","publisher":{"@type":"Organization","name":null,"logo":"https://albert.garcia.gibert.es/favicon.ico"},"author":{"@type":"Person","name":null,"image":{"@type":"ImageObject","url":"https://albert.garcia.gibert.es/favicon.ico","width":250,"height":250},"url":"https://albert.garcia.gibert.es","sameAs":[],"description":"Cofounder and former CTO of @Uvinum, founder of @Obolog. Father of @soclajulia \u0026 @soclabril . I'd like to travel more and improve my guitar skills."},"headline":"Upload de archivos y progressbar con PHP,Perl y AJAX","name":"Upload de archivos y progressbar con PHP,Perl y AJAX","wordCount":1008,"timeRequired":"PT5M","inLanguage":{"@type":"Language","alternateName":"en"},"url":"https://albert.garcia.gibert.es/upload-archivos-progressbar-phpperl-ajax-1511/","datePublished":"2006-03-15T21:41Z","dateModified":"2006-03-15T21:41Z","keywords":"ajax, desarrollo web, javascript, web 2.0","description":"","mainEntityOfPage":{"@type":"WebPage","@id":"https://albert.garcia.gibert.es/upload-archivos-progressbar-phpperl-ajax-1511/"}}</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-97247-14','auto');ga('send','pageview');</script><link rel=preload href=https://albert.garcia.gibert.es/fonts/Open_Sans/OpenSans-Regular.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Open_Sans/OpenSans-Bold.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-Light.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-LightItalic.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-Bold.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-BoldItalic.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Inconsolata/Inconsolata-Regular.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Genericons/Genericons.woff as=font type=font/woff crossorigin></head><body class=nav-closed><div class=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close><span class=hidden>Cerrar</span></a><ul></ul><a class="subscribe-button icon-feed" href=https://albert.garcia.gibert.es/index.xml>Suscríbete</a></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head no-cover"><nav class="main-nav clearfix"><a class=blog-logo href=https://albert.garcia.gibert.es/><img src=https://albert.garcia.gibert.es/favicon.ico alt=Home></a>
<a class="menu-button icon-feed" href=https://albert.garcia.gibert.es/index.xml>&nbsp;&nbsp;Suscríbete</a></nav></header><main class=content role=main><article class="post post-template post"><header class=post-header><h1 class=post-title>Upload de archivos y progressbar con PHP,Perl y AJAX</h1><small></small><section class=post-meta><time class=post-date datetime=2006-03-15T21:41:06Z>Mar 15, 2006</time>
<span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/ajax/>#ajax</a></span><span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/desarrollo-web/>#desarrollo web</a></span><span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/javascript/>#javascript</a></span><span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/web-2.0/>#web 2.0</a></span></section></header><section class=post-content><p>A&#250;n cuando no he conseguido desentramar <a href=https://albert.garcia.gibert.es/mensaje/1505>el misterio de la antena reaparecida</a>, otra misteriosa casualidad ha roto mi paz interior, esta vez relacionada con el trabajo.</p><p>Hoy al llegar a la oficina me he encontrado con una recomendaci&#243;n por mail en qu&#233; se citaba <a href=http://tomas.epineer.se/archives/3>un art&#237;culo en ingl&#233;s</a> que habla acerca de un sistema de carga de ficheros con barra de progreso usando t&#233;cnicas AJAX y PHP+Perl como lenguages de servidor.</p><p>Da la casualidad que llevo semanas intentando montar un sistema as&#237; para el upload de videos y audio en <a href=http://www.obolog.com>OboLog</a> , y de hecho hace algunos d&#237;as que he conseguido <a href=http://www.obolog.com/upload.php>una primera versi&#243;n funcional</a>, y me ha sorprendido que el art&#237;culo de Thomas Epineer, "<a href=http://tomas.epineer.se/archives/3>Asynchronous file upload with AJAX progress bar in PHP</a>", se ha basado exactamente en los mismos proyectos que el "mix" en qu&#233; he estado trabajando, como <a href=http://jquery.com/discuss/2006-March/000226/>apunt&#233;</a> <a href=http://jquery.com/discuss/2006-March/000263/>d&#237;as atr&#225;s</a> en la lista de correo de JQuery.</p><p>Realmente hasta ahora no habia nada sobre el tema, y los &#250;nicos acercamientos al upload de archivos que hac&#237;an uso de AJAX, como el de <a href=http://www.air4web.com/files/upload/>Martin Konicek</a> , dejaban de lado la posibilidad de saber en cada momento qu&#233; porcentaje del archivo llevamos cargado, debido en parte a la limitaci&#243;n de PHP al respecto ( PHP no permite acceder 'en bruto' a los datos POST durante el env&#237;o ).</p><p>El ejemplo de Martin va orientado principalmente al upload de im&#225;genes para una galer&#237;a y esto significa que los archivos no ser&#225;n, en principio, demasiado grandes. En este caso una barra de upload no es imprescindible, puesto que los tiempos de carga ser&#225;n generalmente bastante bajos, y adem&#225;s los ficheros se van cargando en paralelo,en segundo plano, cada vez que el usuario selecciona uno.</p><p>En otras situaciones, sin embargo, como ser&#237;a el caso de v&#237;deos, archivos de audio, o documentos de cierto tama&#241;o ( > 1 MB ), es mucho m&#225;s probable que la demora en la carga pueda provocar desconcierto en el usuario y una ocasional cancelaci&#243;n por su parte, reenviando el formulario o volviendo atr&#225;s para probar de nuevo. La barra de progreso permite que mantengamos informado en todo momento al usuario del estado del upload que est&#225; realizando, y nos evita problemas, consecuencia de las largas esperas y la falta de informaci&#243;n acerca del estado de su solicitud.</p><p>La limitaci&#243;n de PHP la podemos solventar simplemente usando otro lenguaje a la hora de gestionar la carga de los archivos al servidor: un CGI en Perl. Buscando un poco (tampoco hab&#237;a mucha literatura sobre el tema, como os comentaba), en <a href=http://www.raditha.com/>raditha.com</a> encontr&#233; un script que hac&#237;a precisamente esto: combinar PHP y CGIs para conseguir un upload con barra de progreso: <a href=http://www.raditha.com/php/progress.php/>Mega Upload</a>. . B&#225;sicamente lo que hace es generar varios archivos en una carpeta temporal con datos acerca de la carga que se est&#225; realizando: Tama&#241;o total del env&#237;o, nombre de los archivos que se env&#237;an, y datos en bruto del env&#237;o post combinando todos los archivos contenidos. S&#243;lo queda acceder a esos datos de manera repetitiva mientras se lleve a cabo el upload para ir dibujando la correspondiente barra de progreso.</p><p>En la implementaci&#243;n de AJAX, sin embargo, hemos usado herramientas diferentes. Thomas ha usado <a href=http://prototype.conio.net/>Prototype</a>, una librer&#237;a Javascript muy potente (&#191;os suena <a href=http://script.aculo.us/>script.aculo.us</a>?) que permite simplificar algunos procesos para el acceso y la modificaci&#243;n de los elementos DOM y el uso de peticiones as&#237;ncronas via XMLHttpRequest ( AJAX, vamos ). Sin embargo, uno de los problemas de Prototype es, a mi parecer, el excesivo peso de la librer&#237;a por si sola ( sin tener en cuenta ya el peso total de las librer&#237;as JS necesarias si pensamos usar todo el potencial de script.aculo.us ). La versi&#243;n de Prototype inclu&#237;da en el ejempo de Thomas pesa m&#225;s de 40Kb.</p><p>Para llevar a cabo <a href=http://www.obolog.com/upload.php>el experimento</a> que he mencionado arriba he usado una librer&#237;a que descubr&#237; hace poco: <a href=http://www.jquery.com>JQuery</a>. Permitidme tirarme a la piscina, y asegurar sin demasiado miedo a equivocarme, que creo que JQuery es una aut&#233;ntica revoluci&#243;n. En menos de 15Kb de peso tenemos una librer&#237;a que permite simplificar en extremo la sintaxis de Javascript, acceder y modificar el &#225;rbol DOM usando sintaxis de CSS1,2 y 3, XPath y algunos m&#233;todos propios, aplicar efectos visuales sencillos y ejecutar peticiones AJAX, as&#237; como parsear las respuestas resultantes en XML o usarlas para escribir directamente dentro de contenedores de la propia p&#225;gina. Podr&#237;a extenderme largamente, y posiblemente lo haga en el futuro con un post dedicado a JQuery en exclusiva, pero ahora mismo lo m&#225;s sencillo es que<a href=http://www.jquery.com> entr&#233;is a su web</a> y ech&#233;is un vistazo a la <a href=http://jquery.com/docs/>documentaci&#243;n</a> y los <a href=http://jquery.com/docs/Demos/>ejemplos</a> de uso. Sencillamente es-pec-ta-cu-lar. De hecho la estoy usando para simplificar librer&#237;as que uso para otros menesteres, adapt&#225;ndolas al "JQuery way of coding". Os aseguro que la mejora en cuanto a ahorro de espacio y simplificaci&#243;n es del orden del 70%. Tambi&#233;n debo decir, por otra parte, que tiene algunos puntos d&#233;biles: las funciones AJAX devuelven errores o no funcionan correctamente en algunos navegadores. JQuery se encuentra en cont&#237;nua evoluci&#243;n, as&#237; que estoy seguro de que pronto las solucionar&#225;n estos problemas.</p><p>El toque final, la idea de seleccionar varios archivos usando un _aparentemente_ &#250;nico campo "file" la tom&#233; prestada de un art&#237;culo que le&#237; hace un tiempo en StickBlog, "<a rel=bookmark href=http://the-stickman.com/web-development/javascript/upload-multiple-files-with-a-single-file-element/>Upload multiple files with a single file element</a>". El tema es ir creando din&#225;micamente nuevos campos file a medida que el usuario va seleccionando ficheros, e ir ocultando los campos file ya usados. Adicionalemente, para llevar un control de todos los ficheros seleccionados, se va creando una lista con los nombres de los archivos. Hacer todo esto con Jquery no s&#243;n m&#225;s de 5 l&#237;neas de c&#243;digo ( lo pod&#233;is comprobar revisando el c&#243;digo fuente <a href=http://www.obolog.com/upload.php>del experimento</a>).</p><p>Bueno, y eso es todo. Espero que alguien pueda sacar provecho de todo esto, despu&#233;s de la parrafada! Al final la sorpresa me ha inducido a reflexionar en voz alta y dejar por escrito algo en lo que llevaba "trabajando en silencio" desde hace un tiempo. Los usuarios de OboLog lo ver&#233;is en funcionamiento dentro de poco. Tened paciencia. <img border=0 title=Gui&#241;o alt=Gui&#241;o src=https://albert.garcia.gibert.es/js/tiny_mce/plugins/emotions/images/smiley-wink.gif></p></section><footer class=post-footer><figure class=author-image><a class=img href=https://albert.garcia.gibert.es/ style=background-image:url(/images/avatar.jpg)><span class=hidden>Albert García Gibert's Picture</span></a></figure><section class=author><h4><a href=https://albert.garcia.gibert.es/>Albert García Gibert</a></h4><p>Cofounder and former CTO of @Uvinum, founder of @Obolog. Father of @soclajulia & @soclabril . I'd like to travel more and improve my guitar skills.</p><div class=author-meta><span class="author-location icon-location">El Prat de Llobregat, Barcelona</span>
<span class="author-link icon-link"><a href=https://albert.garcia.gibert.es>https://albert.garcia.gibert.es</a></span></div></section><section class=share><h4>Share this post</h4><a class=icon-twitter style=font-size:1.4em href="https://twitter.com/share?text=Upload%20de%20archivos%20y%20progressbar%20con%20PHP%2cPerl%20y%20AJAX&nbsp;-&nbsp;Albert%20Garc%c3%ada%20Gibert&url=https%3a%2f%2falbert.garcia.gibert.es%2fupload-archivos-progressbar-phpperl-ajax-1511%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><span class=hidden>Twitter</span></a>
<a class=icon-facebook style=font-size:1.4em href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2falbert.garcia.gibert.es%2fupload-archivos-progressbar-phpperl-ajax-1511%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><span class=hidden>Facebook</span></a>
<a class=icon-pinterest style=font-size:1.4em href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2falbert.garcia.gibert.es%2fupload-archivos-progressbar-phpperl-ajax-1511%2f&description=Upload%20de%20archivos%20y%20progressbar%20con%20PHP%2cPerl%20y%20AJAX" onclick="window.open(this.href,'pinterest-share','width=580,height=296');return false;"><span class=hidden>Pinterest</span></a></section><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https:\/\/albert.garcia.gibert.es\/upload-archivos-progressbar-phpperl-ajax-1511\/";this.page.identifier="https:\/\/albert.garcia.gibert.es\/upload-archivos-progressbar-phpperl-ajax-1511\/";};(function(){var d=document,s=d.createElement('script');s.src='https://albert-garcia-gibert.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></footer></article></main><aside class=read-next><a class=read-next-story style=no-cover href=https://albert.garcia.gibert.es/fotos-cardona-1551/><section class=post><h2>Fotos desde Cardona</h2></section></a><a class="read-next-story prev" style=no-cover href=https://albert.garcia.gibert.es/duendes-1505/><section class=post><h2>Duendes</h2></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href>Albert García Gibert</a></section><section class=poweredby>Generado con <a class=icon-hugo href=http://gohugo.io>HUGO</a>, con el tema <a class=icon-theme href=https://github.com/vjeantet/hugo-theme-casper>Casper</a></section></footer></div><script type=text/javascript src=https://albert.garcia.gibert.es/js/jquery.js></script><script type=text/javascript src=https://albert.garcia.gibert.es/js/jquery.fitvids.js></script><script type=text/javascript src=https://albert.garcia.gibert.es/js/index.js></script></body></html>