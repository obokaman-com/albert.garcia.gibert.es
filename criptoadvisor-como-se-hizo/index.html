<!doctype html><html lang=es-es><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://albert.garcia.gibert.es/images/2020/10/cryptoadvisorclub-screenshot.png"><meta name=twitter:title content="El making of de CryptoAdvisor.Club"><meta name=twitter:description content><meta name=twitter:site content="@obokaman"><meta property="og:title" content="El making of de CryptoAdvisor.Club &#183; Albert Garc√≠a Gibert"><meta property="og:site_name" content="Albert Garc√≠a Gibert"><meta property="og:url" content="https://albert.garcia.gibert.es/criptoadvisor-como-se-hizo/"><meta property="og:image" content="https://albert.garcia.gibert.es/images/2020/10/cryptoadvisorclub-screenshot.png"><meta property="og:description" content><meta property="og:type" content="article"><meta property="article:published_time" content="2020-10-29T11:13:15Z"><meta property="article:tag" content="proyectos"><meta property="article:tag" content="criptomonedas"><title>El making of de CryptoAdvisor.Club &#183; Albert Garc√≠a Gibert</title><meta name=description content="Anteriormente te explicaba los motivos que nos llevaron a lanzar CryptoAdvisor.Club, el asistente virtual para la inversi√≥n en criptomonedas.
En este art√≠culo t"><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://albert.garcia.gibert.es/images/favicon.ico><link rel=apple-touch-icon href=https://albert.garcia.gibert.es/images/apple-touch-icon.png><link rel=stylesheet type=text/css href=https://albert.garcia.gibert.es/css/screen.css?v2><link rel=stylesheet type=text/css href=https://albert.garcia.gibert.es/css/nav.css?v2><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/default.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><link href=https://albert.garcia.gibert.es/index.xml rel=alternate type=application/rss+xml title="Albert Garc√≠a Gibert"><meta name=generator content="Hugo 0.72.0"><link rel=canonical href=https://albert.garcia.gibert.es/criptoadvisor-como-se-hizo/><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","publisher":{"@type":"Organization","name":null,"logo":"https://albert.garcia.gibert.es/favicon.ico"},"author":{"@type":"Person","name":null,"image":{"@type":"ImageObject","url":"https://albert.garcia.gibert.es/favicon.ico","width":250,"height":250},"url":"https://twitter.com/obokaman","sameAs":[],"description":"Cofounder and former CTO of Uvinum. Founder of Obolog and Splitweet. Father of J√∫lia \u0026 Abril. I'd like to travel more and improve my guitar skills."},"headline":"El making of de CryptoAdvisor.Club","name":"El making of de CryptoAdvisor.Club","wordCount":1140,"timeRequired":"PT6M","inLanguage":{"@type":"Language","alternateName":"en"},"url":"https://albert.garcia.gibert.es/criptoadvisor-como-se-hizo/","datePublished":"2020-10-29T11:13Z","dateModified":"2020-10-29T11:13Z","image":{"@type":"ImageObject","url":"https://albert.garcia.gibert.es//images/2020/10/cryptoadvisorclub-screenshot.png","width":3000,"height":1445},"keywords":"proyectos, criptomonedas","description":"","mainEntityOfPage":{"@type":"WebPage","@id":"https://albert.garcia.gibert.es/criptoadvisor-como-se-hizo/"}}</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-97247-14','auto');ga('send','pageview');</script><link rel=preload href=https://albert.garcia.gibert.es/fonts/Open_Sans/OpenSans-Regular.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Open_Sans/OpenSans-Bold.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-Light.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-LightItalic.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-Bold.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Merriweather/Merriweather-BoldItalic.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Inconsolata/Inconsolata-Regular.ttf as=font type=font/ttf crossorigin><link rel=preload href=https://albert.garcia.gibert.es/fonts/Genericons/Genericons.woff as=font type=font/woff crossorigin></head><body class=nav-closed><div class=nav><h3 class=nav-title>Menu</h3><a href=# class=nav-close title=Cerrar><span class=hidden>Cerrar</span></a><ul></ul><a class="subscribe-button icon-feed" href=https://albert.garcia.gibert.es/index.xml>Suscr√≠bete</a></div><span class=nav-cover></span><div class=site-wrapper><header class="main-header post-head" style=background-image:url(/images/2020/10/cryptoadvisorclub-screenshot_hu748957d5267243476aed6e75f8e799b0_69177_1600x1200_fit_box_2.png)><nav class="main-nav overlay clearfix"><a class=blog-logo href=https://albert.garcia.gibert.es/><img src=https://albert.garcia.gibert.es/favicon.ico alt=Home></a>
<a class="menu-button icon-feed" href=https://albert.garcia.gibert.es/index.xml>&nbsp;&nbsp;Suscr√≠bete</a></nav></header><main class=content role=main><article class="post post-template post"><header class=post-header><h1 class=post-title>El making of de CryptoAdvisor.Club</h1><small></small><section class=post-meta><time class=post-date datetime=2020-10-29T11:13:15Z>29 octubre 2020</time>
<span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/proyectos/>#proyectos</a></span><span class="enumeration post-tag small"><a href=https://albert.garcia.gibert.es/tags/criptomonedas/>#criptomonedas</a></span></section></header><section class=post-content><p>Anteriormente te explicaba <a href=https://albert.garcia.gibert.es/nuevo-proyecto-playground-chatbots-cryptoadvisor/>los motivos que nos llevaron a lanzar CryptoAdvisor.Club</a>, el asistente virtual para la inversi√≥n en criptomonedas.</p><p>En este art√≠culo te comparto algunos detalles t√©cnicos sobre <strong>el stack y las herramientas que hemos utilizado para construir el bot de <a href=https://cryptoadvisor.club/es>CryptoAdvisor.Club</a></strong>.</p><h4 id=el-_stack_-t√©cnico>El <em>stack</em> t√©cnico</h4><ul><li>Es una aplicaci√≥n en <strong>PHP 7.4</strong>, con Symfony. CQRS, DDD, eventos&mldr;</li><li>Usamos intensivamente la librer√≠a <strong><a href=https://botman.io/>BotMan</a></strong>, con algunos drivers propios para modificar algunos comportamientos a la hora de interactuar con men√∫s y botones.</li><li>Varios workers se encargan tanto de los <strong>procesos peri√≥dicos</strong> (sincronizaci√≥n de precios y tratamiento de datos) como de consumir y tratar los <strong>eventos</strong> que se generan en la aplicaci√≥n (eventos de dominio varios, anal√≠tica, sistema de feedback que sincroniza las sesiones de feedback con threads en nuestro Slack&mldr;)</li><li><strong>MySql 8.0</strong> ahora. <strong>DynamoDB</strong> mientras estuvimos en Lambdas en AWS.</li></ul><h4 id=entorno-y-servicios-complementarios>Entorno y servicios complementarios</h4><h5 id=infraestructura>Infraestructura</h5><ul><li><strong>Ansible</strong> y <strong>Terraform</strong> nos permiten provisionar y configurar el servidor y algunos servicios de AWS que utilizamos. Poco que decir: imprescindibles para <strong>abstraer y automatizar cualquier tema relacionado con servicios de infraestructura</strong>.</li><li>La aplicaci√≥n corre en contenedores de <strong>Docker</strong>, tanto en el entorno de desarrollo como en producci√≥n. Usamos <strong>Github Actions</strong> para automatizar el build del contenedor que se usar√° en producci√≥n con la versi√≥n actualizada del c√≥digo, pushearla al registry que tenemos en AWS, y hacer el pull de ese contenedor desde el servidor de producci√≥n, integrando tambi√©n la ejecuci√≥n de los tests, notificaci√≥n a New Relic, Slack, etc.</li><li>Usamos <a href=https://ngrok.com/><strong>ngrok</strong></a> para <strong>crear una URL p√∫blica que sirva de t√∫nel a nuestro entorno local</strong>. Esto es imprescindible para poder llevar a cabo las pruebas durante el desarrollo. Tenemos varios bots de pruebas que usan estas URL p√∫blicas como webhooks. Los comandos para levantar y parar la aplicaci√≥n en desarrollo <strong>automatizan</strong> la ejecuci√≥n de ngrok en segundo plano, la notificaci√≥n de la URL resultante a Telegram y copian la URL p√∫blica de ngrok al portapapeles. <a href=https://gist.github.com/obokaman-com/07e66dcfcbcbe09bce50c970fabac079><em>He compartido el script en un Gist aqu√≠</em> ¬ª</a>.</li></ul><figure><img src=https://albert.garcia.gibert.es/images/2020/10/ngrok.png alt=Ngrok><figcaption><p>Ngrok</p></figcaption></figure><h5 id=monitorizaci√≥n-y-anal√≠tica>Monitorizaci√≥n y Anal√≠tica</h5><ul><li><a href=https://newrelic.com/><strong>New Relic</strong></a> nos permite <strong>monitorizar la performance de la aplicaci√≥n</strong> a un muy bajo nivel: tiempos de respuesta, tracing de transacciones, requests, queries SQL&mldr; con lo que es muy √∫til para <strong>identificar cuellos de botella o posibles optimizaciones a la aplicaci√≥n</strong>. Tambi√©n usamos el sistema de alertas, conectado a nuestro canal de Slack.</li><li>Usamos <a href=https://chatbase.com/products/virtual-agent-analytics/><strong>Chatbase</strong></a> (de Google) como <strong>sistema de anal√≠tica</strong> para entender mejor el uso del chat por parte de los usuarios: qu√© intents hacen matching con el sistema, qu√© interacciones quedan sin respuesta v√°lida y disparan los fallbacks, ver los diferentes <em>funnels</em> de uso&mldr; Ha resultado ser <strong>una herramienta muy √∫til para &ldquo;afinar&rdquo; los intents abiertos del sistema</strong> y ajustarlos a los usos reales de los usuarios.</li></ul><figure><img src=https://albert.garcia.gibert.es/images/2020/10/chatbase.png alt="Session flow en Chatbase"><figcaption><p>Session flow en Chatbase</p></figcaption></figure><h4 id=otras-herramientas>Otras herramientas</h4><ul><li>La landing del proyecto (<a href=https://cryptoadvisor.club>https://cryptoadvisor.club</a>) <strong>es una p√°gina de Notion</strong>. Con Cloudflare haciendo de proxy y <strong>los workers que ofrecen como servicio gratu√≠to</strong>, <a href=https://twitter.com/obokaman/status/1314146211776126976>modificamos request y response para poder servir el contenido desde nuestro propio dominio</a> y con URL personalizadas para cada idioma, hacer que la p√°gina sea visible e indexable por parte de buscadores, etc.</li><li>Tambi√©n en <a href=https://notion.so><strong>Notion</strong></a> es donde gestionamos nuestras tareas, recogemos informaci√≥n interesante o documentamos cualquier cosa. <em>I</em> ‚ù§Ô∏è <em>Notion.</em></li><li>Usamos <strong><a href=https://poeditor.com/>PoEditor</a> para gestionar las traducciones</strong>. Permite la exportaci√≥n de los ficheros en m√°s de 20 formatos, muchos de los cuales son directamente compatibles con Symfony. En su versi√≥n gratu√≠ta se pueden gestionar hasta 1000 cadenas distintas.</li><li>En <a href=https://slack.com><strong>Slack</strong></a> centralizamos tema alertas y <strong>tambi√©n el sistema de soporte y feedback</strong>: los usuarios disponen de un comando especial para compartir feedback con nosotros, que <strong>inicia un thread en nuestro canal de soporte</strong> y nos permite charlar con ellos directamente desde el propio bot.</li></ul><h4 id=otras-cosas-interesantes-que-hemos-probado>Otras cosas interesantes que hemos probado</h4><h5 id=lambdas>Lambdas</h5><ul><li>Probamos por un tiempo, y <strong>terminamos descartando</strong>, montarlo mediante <strong>lambdas en AWS</strong>, por una cuesti√≥n de costes e idoneidad. Las Lambdas, mientras no est√©n en un Security Group, tienen acceso a internet <em>by default</em>. En el momento en qu√© tuvimos que a√±adirlas a un SG para que tuvieran conectividad con otros servicios a los que quer√≠amos dar cierta capa de seguridad, si quer√≠amos que siguieran teniendo conexi√≥n a Internet, deb√≠amos habilitar un Internet Gateway y un NAT Gateway. Termin√°bamos pagando m√°s del doble por estos servicios que por las propias Lambdas.</li><li>Lo interesante del asunto es que <strong>pudimos probar Lambdas con PHP, mediante <a href=https://bref.sh/>bref.sh</a></strong>, una librer√≠a que se integra con <a href=https://www.serverless.com/><strong>Serverless</strong></a> y facilita enormemente todo el proceso de deploy y la integraci√≥n con frameworks como Symfony, ya sea para servir una aplicaci√≥n completa a trav√©s de HTTP, para ejecutar comandos de aplicaci√≥n a demanda en remoto o para configurar eventos que programen la ejecuci√≥n peri√≥dica de determinadas funciones.</li></ul><h5 id=plataformas-y-librer√≠as-para-hahahugoshortcode-s3-hbhb>Plataformas y librer√≠as para
<abbr title="Natural Language Processing">NLP</abbr></h5><ul><li><a href=https://dialogflow.cloud.google.com/><strong>Dialogflow</strong></a> (de Google, antiguamente Api.ai), es una <strong>plataforma de comprensi√≥n de lenguaje natural</strong> pensada para facilitar el dise√±o de interfaces conversacionales. Aunque empezamos a trabajar con ella e integramos algunos intents m√°s complejos a trav√©s suyo, terminamos quit√°ndola de la ecuaci√≥n.<br><br>Al final no dejaba de ser una manera sofisticada de implementar cosas que pod√≠amos conseguir igual, sin a√±adir m√°s capas de complejidad ni dependencias de servicios externos, con expresiones regulares y condiciones, que ten√≠amos igualmente que implementar en su plataforma ü§∑‚Äç‚ôÇÔ∏è, y que doblaban (<em>o m√°s</em>) los tiempos de respuesta del bot.<br><br>En cualquier caso es un servicio interesante con el que es posible <strong>montar un chatbot sin necesidad de implementar ninguna l√≥gica relacionada directamente con la parte conversacional</strong>, y la posibilidad de complementar informaci√≥n con llamadas a webhooks propios, o integrarse con m√∫ltiples plataformas desde un √∫nico lugar.<br><br></li><li><a href=https://deeppavlov.ai/><strong>DeepPavlov</strong></a> es un <strong>framework open source en Python para montar AI conversacionales</strong>. Es uno de los proyectos m√°s interesantes que he conocido este tiempo. Permite implementar sistemas abiertos de preguntas y respuestas, reconocimiento de entidades, de clasificaci√≥n autom√°tica de intents, detecci√≥n de palabras malsonantes&mldr; en base a textos que podemos ofrecer por nuestro lado para entrenar a los modelos con nuestro caso de uso espec√≠fico. <a href=https://demo.deeppavlov.ai/#/mu/ner>Prueba alguna de las demos</a> porque vale la pena.</li></ul><figure><img src=https://albert.garcia.gibert.es/images/2020/10/deep-pavlov-example.png alt="Intent detection con Deep Pavlov"><figcaption><p>Intent detection con Deep Pavlov</p></figcaption></figure><h5 id=integraci√≥n-y-automatizaci√≥n-de-servicios>Integraci√≥n y automatizaci√≥n de servicios</h5><ul><li>Inicialmente usamos tambi√©n <a href=https://www.integromat.com/><strong>Integromat</strong></a> para <strong>automatizar un flujo de recogida > tratamiento > ingesti√≥n de datos</strong> a nuestra API desde las APIs de terceros, pero terminamos descart√°ndolo por tema costes. S√≥lo en lo que se refiere a llamadas a APIs habl√°bamos de unas 800 llamadas cada minuto. Teniendo en cuenta que el coste de Integromat es por &ldquo;operaciones&rdquo;, y cada pipe ten√≠a al menos 4 operaciones:<br>1. llamada API externa<br>2. conversi√≥n de formato<br>3. transformaci√≥n del contenido<br>4. llamada a nuestra API<br><br>Habl√°bamos de <strong>unos pocos millones de operaciones al d√≠a</strong>. Pod√≠amos optimizar algunos de los pasos intermedios, pero seguir√≠a quedando lejos de las 40.000 operaciones mensuales que incluye un plan (de pago) est√°ndar de Integromat. üôÑ</li></ul><p>üëâ <em>Bonus point</em>: Todos estos servicios disponen de versiones gratuitas que, al menos de momento, cubren nuestras necesidades.</p></section><footer class=post-footer><figure class=author-image><a class=img href=https://albert.garcia.gibert.es/ style=background-image:url(/images/avatar.jpg)><span class=hidden>Foto de Albert Garc√≠a Gibert</span></a></figure><section class=author><h4><a href=https://albert.garcia.gibert.es/>Albert Garc√≠a Gibert</a></h4><p>Cofounder and former CTO of Uvinum. Founder of Obolog and Splitweet. Father of J√∫lia & Abril. I'd like to travel more and improve my guitar skills.</p><div class=author-meta><span class="author-location icon-location">El Prat de Llobregat, Barcelona</span>
<span class="author-link icon-link"><a href=https://twitter.com/obokaman>https://twitter.com/obokaman</a></span></div></section><section class=share><h4>Compartir post</h4><a class=icon-twitter style=font-size:1.4em href="https://twitter.com/share?text=El%20making%20of%20de%20CryptoAdvisor.Club&nbsp;-&nbsp;Albert%20Garc%c3%ada%20Gibert&url=https%3a%2f%2falbert.garcia.gibert.es%2fcriptoadvisor-como-se-hizo%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><span class=hidden>Twitter</span></a>
<a class=icon-facebook style=font-size:1.4em href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2falbert.garcia.gibert.es%2fcriptoadvisor-como-se-hizo%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><span class=hidden>Facebook</span></a>
<a class=icon-pinterest style=font-size:1.4em href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2falbert.garcia.gibert.es%2fcriptoadvisor-como-se-hizo%2f&description=El%20making%20of%20de%20CryptoAdvisor.Club" onclick="window.open(this.href,'pinterest-share','width=580,height=296');return false;"><span class=hidden>Pinterest</span></a></section><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https:\/\/albert.garcia.gibert.es\/criptoadvisor-como-se-hizo\/";this.page.identifier="https:\/\/albert.garcia.gibert.es\/criptoadvisor-como-se-hizo\/";};(function(){var d=document,s=d.createElement('script');s.src='https://albert-garcia-gibert.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></footer></article></main><aside class=read-next><a class="read-next-story prev" style=background-image:url(/images/2020/10/cryptoadvisorclub-screenshot.png) href=https://albert.garcia.gibert.es/nuevo-proyecto-playground-chatbots-cryptoadvisor/><section class=post><h2>CryptoAdvisor.Club: El asistente virtual para invertir en criptomonedas</h2></section></a></aside><footer class="site-footer clearfix"><section class=copyright><a href=https://albert.garcia.gibert.es/>Albert Garc√≠a Gibert</a></section><section class=poweredby>Generado con <a class=icon-hugo href=http://gohugo.io>HUGO</a>, con el tema <a class=icon-theme href=https://github.com/vjeantet/hugo-theme-casper>Casper</a></section></footer></div><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script type=text/javascript src=https://albert.garcia.gibert.es/js/jquery.fitvids.js></script><script type=text/javascript src=https://albert.garcia.gibert.es/js/index.js></script></body></html>